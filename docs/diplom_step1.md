<h1 align='center'>REST API</h1>


## 1. Что это такое?

Representational State Transfer(REST), что в переводе передача состояния представления. Технология используя протокол http, позволяет создавать, удалять и изменять данные удалённх приложений.Если говорить проще, то серверное приложение даёт доступ клиентскому приложению к своим данным.

Application Programming Interface (API), или программный интерфейс приложения. Представляет собой набор инструментов, позволяющих разным приложениям работать друг с друом. 

## 2. Как это работает?

Взаимодейстиве клииетских приложений через API просходит по HTTP протоколу передачи данных. Данные отправляются в JSON или XML формате. Последнее время набирает популярность JSON, 

Для создания API необходимы следующие инстрименты:

* Http-сервер (сервер обрабатывающий и перенаправляющих http-запросы)
* Веб-сервер (сервер который реализует работу API)
* База данных (хранение данных)


В этой главе будут раскрыты следующие темы:

* Что такое протокол Http
* Что такое JSON
* Что такое ресурс
* Что такое маршрут и эндпоинт (endpoint)
* Что такое модель данных
* Что такое паттерн "репозиторий"


### 2.1 Протокол HTTP

HTTP — широко распространённый протокол передачи данных, изначально предназначенный для передачи гипертекстовых документов (то есть документов, которые могут содержать ссылки, позволяющие организовать переход к другим документам).

### 2.2 JSON

JSON (англ. JavaScript Object Notation) — текстовый формат обмена данными, основанный на JavaScript. Но при этом формат независим от JS и может использоваться в любом языке программирования. Формат обмена данными, легко читаем людьми, легко обрабатывается и генерируется программами.



Пример json файла:

```
{
    "user_id" : 123,
    "amount" : 80,
    "category" : "Продукты",
    "items" : {
        {
            "description" : "Картофель",
            "amount" : 50
        },
        {
            "description" : "Морковь",
            "amount" : 30
        }
    }
}
```


### 2.2 Ресурс

Ресурсы, как правило, являются разными типами информации. Вы получаете доступ к ресурсам через URL (Uniform Resource Locators), так же как переход к URL-адресу в вашем браузере позволяет подключиться к информационному ресурсу в в виде веб-сайта в интернет. URL-адреса сопровождаются методом, который указывает, как вы хотите взаимодействовать с ресурсом.

Существует 4 типа основных метода взаимодейсвия с ресурсом:

* GET — получение записи
* POST — создание новой записи
* PUT — редактирование записи
* DELETE — удаление записи

При разработке REST API, вы должны сосредоточить свое внимание на ресурсах и способах их идентификации. Способ, которым мы идентифицируем ресурс для предоставления, состоит в том, чтобы назначить ему URI — универсальный идентификатор ресурса.

Ресурс может быть одним одиночным элементом или группой элементов (коллекцией). Например, goods (товары) - это ресурс-коллекция, а good(товар) - ресурс-элемент. Мы можем идентифицировать ресурс коллекции goods(товаров), используя URI /goods , а ресурс одного товара good с помощью следующего URI /goods/{goodId}.

Разработчики REST API должны создавать URI, которые чётко передают модель ресурсов потенциальным разработчикам клиентских приложений. Когда ресурсы названы хорошо, API является интуитивно понятным и простым в использовании. Если же это будет сделано плохо, API может оказаться трудным в использовании и понимании. Ограничение единообразного интерфейса частично устраняется комбинацией URI и HTTP-методов, и использует их в соответствии со стандартами и соглашениями.


### 2.3 Маршрут и эндпоинт


* **Маршрут (Route - роут)** — это «имя», которое отсылает работу API к определенным эндпоинтам. Если упростить, то можно сказать, что маршрут - это URL к которому можно обратиться разными HTTP методами. Маршрут может иметь несколько эндпоинтов.


* **Эндпоинт (Endpoint - конечная точка)** — это само обращение к маршруту отдельным HTTP методом. Эндпоинт выполняют конкретную задачу, принимают параметры и возвращают данные Клиенту.


### 2.4 Модель данных

Модель данных - это способ описания каких-либо данных. В рамках REST API под моделью данных подразумевается описание данных для отображения пользователей, получения информации от пользователей, а так же хранение в базе данных.

Пример на языке программирования Python с использованием библиотеки pydantic:

```
class User(BaseModel):
    user_id: Optional[int]
    first_name: str
    last_name: str
    email: EmailStr
    telegram_id: int

class UserIn(BaseModel):
    user_id: Optional[int]
    email: Optional[EmailStr]
    telegram_id: Optional[int]
```

### 2.5 Паттерн "Репозиторий"

Репозиторий - это паттерн, представляющий собой слой абстракции, инкапсулирующий в себе способ хранения информации. Приемущество использования данного паттерна заключается в том, что мы не привязываем разработку API к конкретной базе данных, а используем лишь методы разработанных репозиториев. А уже в самих репозиториях реализуем работу с базой данных.

Пример репозитория users на языке программирования Pyhton:

```
class UserRepository(BaseRepository):
    
    async def get_all(self)-> List[User]:
        """Получение всех пользователей доступных по токену"""
    
    async def get_by_id(self, u: UserIn) -> User:
        """Получение пользователя по ID"""
        
    async def get_by_email(self, u: UserIn) -> User:
        """Получение пользователя по Email"""
    
    async def get_by_telegram_id(self, u: UserIn) -> User:
        """Получение пользовтеля по telegram_id"""
        
    async def create_user(self, u: UserRegistartion) -> User:
        """Создание пользователя"""
        
    async def put_user(self, u: User) -> User:
        """Изменение информации о пользователе"""
        
    async def delete_user(self, u: UserIn) -> User:
        """Удаление пользовтаеля"""
        
    async def merge_user_defferent_platform(self, u: UserIn) -> User:
        """Слияние учётных записей одного пользователя с разных платформ"""

```




## 3. Ошибки проектирования REST API

### 3.1 Включение тривиальных дейсвий в URL

Поясняю что имею ввиду: не стоит использовать слова по типу create, update, delete в описании эндпоинта, это создаёт ненужную привязу url к действию.

Плохой пример:
```
POST http://funny-code.ru/api/v1/users/create/
GET  http://funny-code.ru/api/v1/users/getting/
POST http://funny-code.ru/api/v1/users/update/
POST http://funny-code.ru/api/v1/users/delete/
```

Хороший пример:
```
POST    http://funny-code.ru/api/v1/users/
GET     http://funny-code.ru/api/v1/users/
PUT     http://funny-code.ru/api/v1/users/
DELETE  http://funny-code.ru/api/v1/users/
```

### 3.2 Неправильное использование http-методов Putch и Put

Put - Полная замена объекта
Putch - частачное обовление объекта

### 3.3 Игнорирование time-зон свойств даты и времени

### 3.4 Не использование подробных кодов ответов

Вот список с примерами http ответов которые не только не стоит игнорировать, но и только помогут в разработке "клиента"

* **200** - "Успешно". Запрос успешно обработан. Что значит "успешно", 
* **204** - "Нет содержимого". Нет содержимого для ответа на запрос, но заголовки ответа, которые могут быть полезны, присылаются. Клиент может использовать их для обновления кешированных заголовков полученных ранее для этого ресурса.
* **400** - "Плохой запрос". Этот ответ означает, что сервер не понимает запрос из-за неверного синтаксиса. 
* **401** - "Неавторизованно". Для получения запрашиваемого ответа нужна аутентификация. Статус похож на статус 403, но,в этом случае, аутентификация возможна. 
* **403** - "Запрещено". У клиента нет прав доступа к содержимому, поэтому сервер отказывается дать надлежащий ответ. 
* **404** - "Не найден". Сервер не может найти запрашиваемый ресурс. Код этого ответа, наверно, самый известный из-за частоты его появления в вебе. 
### 


## 4. Полезные практики проектирования REST API

### 4.1 Версия API

Допустим вы уже запустили открытое API, оно работает и его используют. Но в один момент вы понимаете что допутили ряд серьёзных ошибок при проектировании API. Плохой практикой будет брать и переделывать всё архитектуру микросервиса. Так как это повлечёт за собой выход из строя приложений работающих с этим API.

Хорошим выходом из ситуации является версия API.

Пример хорошо спроектированной архитектуры:

```
# Старая версия API, она всё так же работает
# и не выводит из строя работающие приложения
GET http://funnny-code.ru/api/v1/users/

# Новая версия API, она не мешает строй,
# это новое отвлетвление, новая архитектура
GET http://funny-code.ru/api/v2/users/
```

Вам ничего не мешает взять и добавить новую версию вашего интерфейса и всё будет работать как и работало раньше.

Выбор остаётся за пользователем этого API. Оставаться на старой версии, либо же внести изменения в своё приложение и перевести его на новую версию API



### 4.3 Ведение актуальной документации

Казалось бы очевидно, но далеко не всегда это выполняется. Из-за чего время на реализвацию может увеличиться в несколько раз. Допустим в компании работает 2 человека, один пишет backend (API), а второй frontend. И тот что делает api, не ведёт дументацию по работе его интерфейса. Что становится причиной задержек в работе второго работника, ему требуется время чтоб понять что делать тот или иной метод, только после этого он сможет его использовать.


### 4.4 Стандартизация ответов

Когда API разрабатывают несколько человек, стоит обсудить и составить стандартизированный набор ответов. Что только защитит от ненужного рефакторинга и сократить затраты на человеко-часы.



### 4.5 Pure-data

REST API - это абстракция между backend и frontend, и не нужно наполнять её ненужной информацией. Отдавать следует только чистые данные и ничего лишнего. Разные фреймворки добавляют свои данные в ответ, что нужно присекать. Когда ваш API использует десяток человек, это может быть не заметно, но когда трафик увеличивается до нескольких десяток тысяч, возникнут вопросы почему потребление ресурсов больше в несколько раз.


### 4.5 Покрытие API тестами